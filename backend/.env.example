# Backend runtime
PORT=3002
PROCESSOR_WORKER_ID=worker-local
WEBHOOK_SECRET=replace-with-strong-webhook-secret

# Azure OpenAI
AZURE_OPENAI_ENDPOINT=https://your-openai-resource.openai.azure.com
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_DEPLOYMENT=gpt-4o-vision
AZURE_OPENAI_API_VERSION=2024-02-15-preview

# Azure SQL (managed identity token auth)
AZURE_SQL_SERVER=your-server.database.windows.net
AZURE_SQL_DATABASE=your-database

# Azure Blob Storage (managed identity only)
AZURE_STORAGE_ACCOUNT_NAME=your-storage-account
AZURE_STORAGE_CONTAINER=videos

# Optional observability
# APPINSIGHTS_CONNECTION_STRING=InstrumentationKey=...

# =============================================================================
# V3 Accuracy Upgrade - Analysis Engine Configuration
# =============================================================================

# Active analysis engine version (default: v2_baseline)
# Options: v2_baseline, v3_hybrid
ANALYSIS_ENGINE_ACTIVE=v2_baseline

# Shadow engine for A/B comparison (optional, runs in parallel)
# When set, shadow analysis results are stored but not shown to users
# ANALYSIS_ENGINE_SHADOW=v3_hybrid

# Sample rate for shadow analysis (0.0-1.0, default: 0.25)
# Only applies when ANALYSIS_ENGINE_SHADOW is set
ANALYSIS_SHADOW_SAMPLE_RATE=0.25

# Hard cap on total tokens per run (default: 300000)
# Analysis stops when this limit is reached
ANALYSIS_TOKEN_HARD_CAP_TOTAL=300000

# Hard cap on tokens per frame analysis (default: 18000)
ANALYSIS_TOKEN_HARD_CAP_PER_FRAME=18000

# =============================================================================
# V3 Accuracy Upgrade - Preprocessing Configuration (Day 3-4)
# =============================================================================

# Enable V3 change-focused preprocessing (default: true)
# When enabled, uses region-based change detection and injects change context into prompts
PREPROCESSING_ENABLE_CHANGE_DETECTION=true

# Grid dimensions for region-based change detection (default: 4x4)
PREPROCESSING_CHANGE_GRID_ROWS=4
PREPROCESSING_CHANGE_GRID_COLS=4

# Minimum region intensity threshold to consider changed (0.0-1.0, default: 0.05)
PREPROCESSING_MIN_REGION_INTENSITY=0.05

# Pixel difference threshold for change detection (1-255, default: 25)
PREPROCESSING_PIXEL_DIFF_THRESHOLD=25

# Frame resize for change analysis (64-512, default: 256)
PREPROCESSING_CHANGE_ANALYSIS_SIZE=256

# Include change context annotations in vision prompts (default: true)
PREPROCESSING_INCLUDE_CHANGE_CONTEXT=true

# =============================================================================
# V3 Accuracy Upgrade - Two-Pass Inference Configuration (Day 5-6)
# =============================================================================

# Enable two-pass inference (Pass A: extraction, Pass B: scoring) (default: true)
# When enabled, uses structured interaction extraction before rubric scoring
TWO_PASS_ENABLE=true

# Maximum reruns per frame for self-consistency (0-5, default: 2)
# Higher values improve consistency but increase token usage
TWO_PASS_MAX_RERUNS=2

# Schema coercion threshold to trigger rerun (0.0-1.0, default: 0.3)
# Rerun if more than this percentage of fields needed coercion
TWO_PASS_SCHEMA_COERCION_THRESHOLD=0.3

# Minimum confidence threshold to accept without rerun (0.0-1.0, default: 0.6)
# Rerun if confidence is below this threshold
TWO_PASS_MIN_CONFIDENCE_THRESHOLD=0.6

# Token budget for Pass A extraction (default: 1500)
TWO_PASS_A_TOKEN_BUDGET=1500

# Token budget for Pass B rubric scoring (default: 2000)
TWO_PASS_B_TOKEN_BUDGET=2000
